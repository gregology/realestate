namespace :regions do
  desc "Create regions"
  task :create => :environment do
    
    prince_edward_county = "ST_MakePolygon( ST_GeomFromText('LINESTRING(-77.15278689223894 43.81692450051234,-76.76414973513963 43.9311656223183,-76.84638640240468 44.12706534128443,-76.95781960593069 44.0609322760221,-76.99816921764838 44.04487533576555,-77.03239759987196 44.04065475030288,-77.09288769091404 44.0488303238205,-77.11733461601229 44.04304668767801,-77.11037678693127 44.05677520056156,-77.09062251536146 44.07480014974021,-77.07576124966545 44.0962036261315,-77.07299423988015 44.11600202402476,-77.06595113397037 44.13542942057799,-77.05543658068333 44.16340811725143,-77.04845873621879 44.17934204776876,-77.05411339928712 44.18570599284728,-77.08863490977154 44.1725732602382,-77.11470977695798 44.1672828576047,-77.14031224338177 44.15815160330263,-77.18824825239817 44.15273673861035,-77.2372818443072 44.15093030671276,-77.30105460683833 44.15008932357954,-77.34591853475116 44.15156176027375,-77.37763660003725 44.14756333892132,-77.4496983994657 44.12302255389384,-77.49885860533171 44.11029690881971,-77.53479185612902 44.0866122481198,-77.58056988838021 44.06130034873489,-77.67765990813355 44.03190915505701,-77.69445229337711 44.02684587223976,-77.69476698665589 44.01764517241357,-77.68261044724657 44.01080897859769,-77.62686781457349 44.01853540816694,-77.54880080239656 43.9374023108411,-77.53321838284356 43.89822054281536,-77.33712577025014 43.93817610865837,-77.23654381838092 43.82620866305203,-77.15278689223894 43.81692450051234)'))"
    prince_edward_county_non_coastal = "ST_MakePolygon( ST_GeomFromText('LINESTRING(-77.52339909900576 44.08055769510196,-77.53013032427303 44.07783759672061,-77.53570394483961 44.07779935110125,-77.53866474971579 44.07650847635027,-77.54114061725804 44.07526214152277,-77.54375620731906 44.07323777745879,-77.54617102358458 44.07136668270959,-77.54665299208602 44.06909052993005,-77.55077843771986 44.06711418153388,-77.55532963613601 44.06513637432691,-77.55905750079654 44.06320666518148,-77.56555377308902 44.05805264824841,-77.57169132736738 44.05200139267697,-77.57587963572156 44.0501707204652,-77.58112007611329 44.05145840939055,-77.58019295693627 44.05486310697385,-77.58939034867844 44.05554320958141,-77.59128012135662 44.05685568121284,-77.65948909722778 44.03616814903238,-77.6558756990426 44.02920734682991,-77.68647577674463 44.02318283122989,-77.68557740805673 44.02110035139039,-77.67891924111302 44.0230031184178,-77.67393537084182 44.01929227059404,-77.67242999373822 44.02458784356331,-77.66645181680022 44.0244529614912,-77.65844168435375 44.02582399216623,-77.65712122981397 44.02272473377167,-77.6463007148473 44.02330654188595,-77.64430801205076 44.02416835541138,-77.64163727292394 44.02069844034911,-77.63317799412816 44.02310075736792,-77.63268876144488 44.02712067227932,-77.63022883105795 44.02975588004983,-77.62976138192242 44.03390206479978,-77.62576396074368 44.03499347831074,-77.62293937208622 44.03559455977246,-77.62490126280282 44.03851122705716,-77.61586256200231 44.03967506203497,-77.60738174646309 44.03875372646759,-77.60497188163946 44.0390340813186,-77.59837121520188 44.03842432989138,-77.59401076517287 44.03693055570587,-77.59086898558812 44.03514443568313,-77.59234530247379 44.03406284132083,-77.59188373672197 44.03369047895006,-77.5930643273807 44.0323885609994,-77.59089731651008 44.02939073545544,-77.58828934527676 44.03148546315487,-77.58326829323323 44.02922558346562,-77.58427815670935 44.02783999744047,-77.58161190154588 44.02953164490888,-77.57269459112034 44.0327720254982,-77.56837886289739 44.033327624533,-77.56837932810544 44.02992645363945,-77.57353606915156 44.02554443381875,-77.57236590863991 44.02376226177935,-77.57839219468622 44.02028240097783,-77.58026925855039 44.01834553131983,-77.57804398574359 44.01674839057198,-77.5729593886262 44.01733499183698,-77.5698779550837 44.01442353176691,-77.56839128884981 44.01186489105577,-77.56908003513257 44.00982374718259,-77.56710512143954 44.00938025631523,-77.56476068997326 44.01014298664264,-77.56243994455451 44.01088841611602,-77.5600204194722 44.01333950958523,-77.55785089028358 44.01578913911504,-77.55145991335844 44.0133386078545,-77.54683922844238 44.01158061088768,-77.53855770652659 44.01091270821731,-77.53395609939751 44.01160798809557,-77.53053601915251 44.00891931978547,-77.52757323273092 44.0068760532347,-77.52184473846557 44.00454936362539,-77.51751438241837 44.00631329033607,-77.51507753581269 44.00373556610694,-77.51919201719561 44.00224845795513,-77.52079203931083 43.99735706601346,-77.52116209996393 43.9963464388174,-77.5234837832632 43.99682809838512,-77.52422542787347 43.99606459643575,-77.5232119374062 43.99595750200988,-77.52177951658193 43.99512238425756,-77.51983028680596 43.99641760550153,-77.51948488680156 43.99569010780252,-77.52200082735098 43.99334719955829,-77.52591838233643 43.99400255440761,-77.52823199410903 43.99352098045121,-77.52647059928553 43.9916212547142,-77.53048771059726 43.99008833036458,-77.53132255125438 43.99164369802151,-77.53533837554316 43.9896410618783,-77.53400100308264 43.98843644772379,-77.53707002954307 43.98721482876923,-77.54732622294559 43.98651419958647,-77.54913195494589 43.98589086627715,-77.54997206085412 43.98711264743703,-77.55351101936563 43.9857598129063,-77.55640664568175 43.98592300492176,-77.56055444419943 43.98439026510388,-77.56696626505804 43.97730837078753,-77.56149828011054 43.97244669012994,-77.5446639739824 43.97034359609739,-77.53137805543408 43.96778005161826,-77.51876326787709 43.96701347337657,-77.51713702196189 43.96456770265792,-77.51684703747624 43.9607955792964,-77.5191610219032 43.95704904380719,-77.52085919320739 43.95410840657603,-77.51821716332849 43.95083126157176,-77.50285413649935 43.9588610248625,-77.50321603590059 43.96003480096041,-77.49727785648287 43.96206504739333,-77.48493160394345 43.9645840918572,-77.47976892057973 43.96016751984981,-77.49049203923545 43.95413491902447,-77.49800364572276 43.94626921163042,-77.49142055289393 43.93733265422976,-77.48946393737056 43.92776035916027,-77.47469747183214 43.92976582245476,-77.4605775408556 43.93052344706687,-77.4556610226573 43.92901067933627,-77.45176046953566 43.92846460843937,-77.43951742146041 43.93096133303846,-77.41774578995242 43.93747708836234,-77.40977037908355 43.93741838048589,-77.39995359792529 43.93769890906131,-77.39224170487641 43.94017068473586,-77.38055065410123 43.94329776172529,-77.37891003308459 43.9437745728221,-77.37842231470029 43.94302201928267,-77.37361721173053 43.94444444980707,-77.37410295616741 43.94595045758864,-77.37194072529989 43.94667906664153,-77.37120839548027 43.94567549811578,-77.36967304670216 43.94622819283329,-77.37012730884067 43.94733088354941,-77.36747642727023 43.94828622564878,-77.35367494476665 43.95167785380563,-77.3390101782489 43.95245770459267,-77.32031776055187 43.95857349480297,-77.31478988463827 43.95992692479394,-77.30298387786171 43.96045557832404,-77.29694857001215 43.96088026348622,-77.28793484843651 43.96375142808957,-77.25416057594464 43.97231679582424,-77.25402090916933 43.96397275616856,-77.2385937163844 43.96782861684507,-77.23293745269139 43.96660449959787,-77.23268918369286 43.96497013961032,-77.23789316714239 43.96155111630591,-77.2388847128498 43.95899381517845,-77.23873631936532 43.95731357166018,-77.23727465751119 43.95593166108066,-77.23636611443534 43.95370186897838,-77.239943340696 43.94622335856073,-77.24782075415571 43.93933125661651,-77.25161098625632 43.93565463744252,-77.25557102067496 43.93033641947972,-77.25804515724803 43.9263263186643,-77.26255224848883 43.92136210707765,-77.26659274865962 43.91711403294064,-77.26811861624223 43.91446926107636,-77.26890217214367 43.91268420998635,-77.26943823222486 43.90932983662771,-77.2674267744527 43.90768556742949,-77.26361060427988 43.90673147358017,-77.26213533653288 43.90728900607714,-77.25811241063425 43.90657434623824,-77.25139540534065 43.90502709440628,-77.24562166210927 43.9097046625773,-77.24161426176651 43.91145404150249,-77.23483462207768 43.91677142446883,-77.23215936426662 43.92012718227475,-77.22890152519047 43.92218053713246,-77.22595432302214 43.92321821367447,-77.22156573110536 43.92395968452561,-77.21093967508808 43.92810679872348,-77.19833382153875 43.93441921290304,-77.18936450810867 43.94017695136861,-77.18361564439014 43.94579628893539,-77.17638955847377 43.9514719050112,-77.16487291667333 43.95803366970731,-77.14980027931145 43.9383781481274,-77.15361672382485 43.93682159812369,-77.1570750154533 43.93541236872338,-77.15676933740204 43.93467488772005,-77.1587194090189 43.93366895521372,-77.15938298936467 43.93452202716959,-77.16286381183382 43.93294304506622,-77.16200374834222 43.93189861974824,-77.16727398500085 43.92891374045014,-77.17514932614762 43.92286420731568,-77.18143434092008 43.91842153407865,-77.1845404648848 43.91624488932492,-77.18523765749856 43.9154197521822,-77.18609035895254 43.91285467261658,-77.18703105609742 43.91159918293977,-77.19194749587514 43.9090096819025,-77.1949191858527 43.90686786883106,-77.19589993507871 43.90550387782517,-77.19615697503522 43.90384628748178,-77.19678722486634 43.90216596709411,-77.19628065281427 43.89903891254528,-77.19720327032033 43.89631762067708,-77.1990540076989 43.89393272032039,-77.20627527840722 43.88899706816267,-77.20828767479705 43.88766044224946,-77.21029321806006 43.88847735678589,-77.21310934272066 43.88575267501411,-77.21043656002014 43.88429942931237,-77.2102596468397 43.8822088913392,-77.22705984552188 43.8706936364681,-77.22019871229396 43.86291454436219,-77.20823424487617 43.86737705707029,-77.19918366949834 43.87084206618108,-77.19163884890939 43.87654110455534,-77.18777555902022 43.87816687802934,-77.17550888590191 43.87337684907049,-77.15837870900442 43.86817187240427,-77.1564599184178 43.8586533231093,-77.15529142198804 43.84579660997336,-77.14020950440343 43.85284605413867,-77.05583893575266 43.89481787124907,-77.02966441405999 43.90231590800847,-77.02022656236699 43.89794259746856,-77.00593736643269 43.90789289464318,-76.98171683890222 43.91848010954459,-76.9329862280813 43.92836996877847,-76.94219969768088 43.92918151052002,-76.94653912989757 43.93005695439735,-76.94873131498753 43.93167718746859,-76.95042610038691 43.93109633314663,-76.96229209199512 43.93876730469663,-76.98134232853364 43.93185233629475,-76.9877208282202 43.93150315540476,-76.99578892472313 43.92847644943958,-77.0099791157475 43.93520710739462,-77.01693133815698 43.93331037586043,-77.0208020453624 43.9192290827538,-77.02581240276565 43.91608733211785,-77.0369494059823 43.90997722384386,-77.04146638922467 43.90875527403608,-77.04527086638029 43.90927746343594,-77.05235554838544 43.91660389351215,-77.05406700916939 43.9199807352317,-77.0541916751305 43.92362880214456,-77.04586131316609 43.93202850130116,-77.04869557113831 43.93522534920883,-77.04839008901594 43.94003818790918,-77.04716875318124 43.94467695812124,-77.0481211172908 43.94792657345337,-77.04043220695323 43.95913947878221,-77.03503540175888 43.96740926417463,-77.03009966305726 43.96961378515421,-77.02338973770365 43.97127608586607,-77.01769060667775 43.97675507870006,-77.00929931343822 43.98192398999029,-77.01189374635726 43.98448685560935,-77.02757656187394 43.97524003736851,-77.03905750490053 43.98613443562439,-77.02110572356948 43.99993724648792,-77.0135633242902 44.00389130580022,-77.00574651987743 44.00668591628918,-77.00066494209227 44.00193363408177,-76.97148959794868 44.01570580325283,-76.95507606215439 44.02457972797344,-76.93567202078904 44.02630715103354,-76.92978487575544 44.02920646111873,-76.92325219601777 44.03100346714781,-76.91526316051899 44.03140717539387,-76.90958448590536 44.03303190163807,-76.90659855366218 44.0366873368564,-76.90531110498685 44.04046016519901,-76.90553216812123 44.04760019155623,-76.9013835110225 44.05709114347132,-76.89772222562522 44.06066496332372,-76.8938357440162 44.06375011566884,-76.88873428042204 44.06770809869372,-76.87286257468813 44.07696019065214,-76.88059203830164 44.08717524209281,-76.88512879626988 44.08729103712878,-76.88988678738389 44.09089189525429,-76.89893478564537 44.0858134607432,-76.90203934509938 44.08174309719115,-76.9054403186672 44.07993706667605,-76.90937637053968 44.07670764261005,-76.91604455055698 44.07309283601786,-76.92320693632971 44.06787495437933,-76.92953464689366 44.06224367008066,-76.92654598724894 44.05856323242808,-76.92694409923484 44.05632013530647,-76.9607671512384 44.04984713937245,-76.96731413672387 44.04763980631279,-76.97343701916058 44.04456824446812,-76.97818925581799 44.04167367465909,-76.98335413621842 44.03918622112982,-77.01285333586149 44.03460026883578,-77.01777414600532 44.03202807502508,-77.02011146793537 44.02924988809585,-77.02365894147572 44.02930429761899,-77.02686683418084 44.03039351679031,-77.03113085030641 44.0306255240948,-77.03622118842308 44.03373007002983,-77.05030185502993 44.03529412748589,-77.0567634048805 44.03967707995974,-77.061343488098 44.04133519569105,-77.06446442278838 44.04220620869883,-77.06810208004217 44.04255497755126,-77.07480063708554 44.04394774798119,-77.08916177685572 44.0438873593948,-77.09336497642614 44.04248960170252,-77.09973660154871 44.04185487541644,-77.10587187328217 44.04011329814607,-77.11771864716083 44.03350034161537,-77.11829184839857 44.02540459728375,-77.12637281806404 44.0140232418826,-77.13437967821923 44.00849290096659,-77.13917980511046 44.00855541431554,-77.13465734589654 44.01486198925394,-77.1339940344408 44.01612337573192,-77.13632610678042 44.01655232197394,-77.13578712794765 44.0184123854351,-77.1354927657425 44.02596124259005,-77.13869129782375 44.03153438966658,-77.14245982020471 44.03716201388423,-77.1373736781909 44.03584682103536,-77.12651279286037 44.04683277266655,-77.11004303936704 44.06704430461323,-77.09661243599584 44.07625583465408,-77.09063613663295 44.0875784402502,-77.08571133048993 44.09138141724628,-77.08410677395624 44.09406628670997,-77.08528289977541 44.10096199685781,-77.08300899476943 44.10265553019092,-77.08190953708265 44.10489157221431,-77.08224547944536 44.10711225288354,-77.08510520837453 44.11025706338297,-77.08511469289031 44.11533589683886,-77.07677125029858 44.12029369894632,-77.07579080441521 44.12369232538551,-77.07595111499248 44.12605147778228,-77.07755707748345 44.12846789342428,-77.07517877651551 44.13420606265908,-77.07232971800414 44.13650428526065,-77.07315833374074 44.13977198290829,-77.07150919100671 44.1435883109968,-77.07029735139264 44.1470751174223,-77.06809380717274 44.1506460035155,-77.07051302118076 44.15353515282195,-77.08503051743185 44.16865999887195,-77.09101803524186 44.16658973729457,-77.10149203108395 44.16227488003553,-77.10919316643398 44.16130584177986,-77.11670392616749 44.15707942589152,-77.12617529208603 44.15459062622232,-77.13565455884485 44.14967229146351,-77.15310597643047 44.14728433883874,-77.16193434201662 44.14861971330222,-77.17060369300958 44.14724202879079,-77.17564847354178 44.14467712071233,-77.18006525622702 44.1415546958395,-77.18425826703323 44.13178373206416,-77.18830445557116 44.12699561915866,-77.19302419507929 44.12290462526732,-77.20269702105277 44.11854354169646,-77.21083906741595 44.11297577017752,-77.21523271993814 44.1082597729562,-77.22190368316211 44.10389520883606,-77.23090970531788 44.11016845204079,-77.21251257883281 44.12245334561882,-77.19936926195847 44.13142253760692,-77.1997917049375 44.1382267385933,-77.20417158488927 44.13950046627215,-77.20785263315858 44.13853535355567,-77.21181852305745 44.13801996173821,-77.22567202853233 44.13428727031791,-77.22785180445993 44.13308260169155,-77.23072670746083 44.13233785225145,-77.23572198897872 44.13414103468564,-77.24554687095095 44.13038967935964,-77.24097871782544 44.12110591714266,-77.24646263302883 44.11600232791955,-77.26845483049765 44.10713550620378,-77.28174819489047 44.1049754071801,-77.27800068118417 44.09967205922588,-77.26617657052076 44.10170960742789,-77.24518357811664 44.10847397999564,-77.23136036963497 44.10994922716572,-77.22360507097099 44.10482841884678,-77.21533543489309 44.09605010562677,-77.22648340517514 44.09224549666401,-77.22683989868597 44.0878878365009,-77.22917240851486 44.08652636832594,-77.24516437388532 44.08412295078052,-77.24842551428635 44.08261214169827,-77.25550457233825 44.08269079507338,-77.26252567716153 44.0831546469163,-77.27432390233149 44.08126056549817,-77.27875618005092 44.08153153213694,-77.28497030415978 44.07943391645821,-77.29446773663231 44.08016591279726,-77.30360196108533 44.07585349767689,-77.30642421146209 44.07169717736404,-77.31148690473206 44.06815796200304,-77.31588480581638 44.06967614493769,-77.32876895750475 44.07700668192975,-77.37392392263207 44.07792337186947,-77.36628077905152 44.09427352129589,-77.36216611969104 44.10099963435958,-77.33417372004853 44.12356914905368,-77.31053750704895 44.13498341609932,-77.31603256762035 44.13764113208899,-77.31482240725975 44.13955176773604,-77.32055049930436 44.14041419875081,-77.32264707881291 44.13821449607288,-77.32692943306715 44.14002287829989,-77.33523526983294 44.13740849996415,-77.34775393162913 44.1353247283379,-77.35055440882391 44.13823946942449,-77.3620146544972 44.13411748901718,-77.36872044646404 44.12873446847576,-77.36612901522693 44.12473395934616,-77.39187637086063 44.10600780985516,-77.38769412854771 44.11765585298059,-77.37518693794655 44.12726014753509,-77.38632747779266 44.1379787453055,-77.39748264295983 44.13066063216223,-77.40556066941288 44.12648961644475,-77.41549276166718 44.12356156561494,-77.43223973333883 44.11810865031694,-77.44952865791244 44.11319587105263,-77.45579256784883 44.11180689681748,-77.47264174995298 44.10984261613096,-77.4777534350961 44.10818948690326,-77.48189352704851 44.10610889586,-77.48638274741734 44.10330959565661,-77.49107948407463 44.09964320195321,-77.49878560638825 44.09601657436029,-77.50779989903991 44.08955215481534,-77.51276757558438 44.0864022178972,-77.52339909900576 44.08055769510196)'))"

    prince_edward_county_coast = Region.find_or_create_by(title: 'prince_edward_county_coast')

    affected_rows = ActiveRecord::Base.connection.update <<-SQL
      UPDATE regions
      SET area = ST_Difference(#{prince_edward_county}, #{prince_edward_county_non_coastal})
      WHERE id = #{prince_edward_county_coast.id};

    SQL

    puts "#{affected_rows} regions updated or created"
  end
end